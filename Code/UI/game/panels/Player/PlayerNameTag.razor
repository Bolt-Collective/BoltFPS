@inherits PanelComponent

@namespace Seekers

@if ( !Pawn.IsValid() ) return;

<root>
	<div class="hud">
		<h5 class="nametag">@_playerName</h5>
		<p>@(MathF.Floor( _playerHealth ) )%</p>
	</div>
</root>

@code
{
	public Pawn Pawn => Pawn.Local;
	private Ray AimRay => Pawn?.AimRay ?? new Ray(  );

	private string _playerName;
	private float _playerHealth;

	bool isShowing;

	protected override void OnPreRender()
	{
		base.OnPreRender();

		if ( !Pawn.IsValid() )
			return;

		var tr = Scene.Trace.Ray( AimRay, 500f )
			.IgnoreGameObjectHierarchy( Pawn?.GameObject )
			.WithoutTags( "movement", "prop", "playerprop" )
			.HitTriggers()
			.Run();

		isShowing = false;

		if ( tr.Hit && tr.GameObject != null )
		{
			isShowing = tr.GameObject.Components.TryGet( out Pawn target, FindMode.EverythingInSelfAndParent ) && target.IsValid();

			if ( isShowing )
			{
				_playerName = target?.Network?.Owner?.DisplayName;
				_playerHealth = target.Health;
			}
		}

		SetClass( "show", isShowing );
	}


	protected override int BuildHash()
	{
		return HashCode.Combine( isShowing, _playerHealth );
	}
}
